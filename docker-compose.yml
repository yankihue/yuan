version: '3.9'

services:
  orchestrator:
    build:
      context: .
      target: orchestrator
    env_file:
      - .env
    environment:
      - ORCHESTRATOR_PORT=${ORCHESTRATOR_PORT:-3000}
    ports:
      - "${ORCHESTRATOR_PORT:-3000}:3000"
    volumes:
      # Named volume for Claude credentials (run 'docker compose exec orchestrator claude login' to authenticate)
      - claude-credentials:/root/.claude
    restart: unless-stopped

  telegram-bot:
    build:
      context: .
      target: telegram-bot
    env_file:
      - .env
    depends_on:
      - orchestrator
    environment:
      - ORCHESTRATOR_HOST=orchestrator
      - ORCHESTRATOR_PORT=${ORCHESTRATOR_PORT:-3000}
    restart: unless-stopped

volumes:
  claude-credentials:
